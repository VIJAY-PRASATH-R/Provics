<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IV Planner & Connector{% endblock %}</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head %}{% endblock %}
</head>

<body>
    <header class="header">
        <div class="container header-container">
            <a href="/" class="logo" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Provics Logo" style="height: 40px;">
            </a>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="#" class="nav-link">About</a></li>

                    {% if session.user_id %}
                    <!-- Authenticated User Links -->
                    <!-- Notifications Dropdown -->
                    <li style="position: relative;">
                        <a href="#" class="nav-link"
                            onclick="document.getElementById('notif-dropdown').classList.toggle('show'); return false;"
                            style="font-size: 1.2rem; text-decoration: none;">
                            ðŸ””
                            {% if unread_count > 0 %}
                            <span
                                style="background: #dc2626; color: white; border-radius: 50%; padding: 0.1rem 0.4rem; font-size: 0.7rem; position: absolute; top: 0; right: 0;">{{
                                unread_count }}</span>
                            {% endif %}
                        </a>
                        <div id="notif-dropdown"
                            style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e2e8f0; width: 320px; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 1000; overflow: hidden;">
                            <div
                                style="padding: 1rem; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0; font-size: 0.95rem; color: var(--primary-color);">Notifications
                                </h4>
                                {% if unread_count > 0 %}
                                <a href="{{ url_for('mark_notifications_read') }}"
                                    style="font-size: 0.8rem; color: #3b82f6; text-decoration: none;">Mark all read</a>
                                {% endif %}
                            </div>
                            <ul style="list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto;">
                                {% if notifications %}
                                {% for n in notifications %}
                                <li
                                    style="padding: 0.75rem 1rem; border-bottom: 1px solid #f8fafc; {% if not n.is_read %}background: #f0f9ff;{% endif %}">
                                    <p style="margin: 0; font-size: 0.85rem; color: #334155;">{{ n.message }}</p>
                                    <span style="font-size: 0.75rem; color: #94a3b8;">{{ n.created_at.strftime('%H:%M')
                                        }}</span>
                                </li>
                                {% endfor %}
                                {% else %}
                                <li style="padding: 1.5rem; text-align: center; color: #94a3b8; font-size: 0.9rem;">
                                    No recent notifications
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                    </li>

                    {% if session.role == 'student' %}
                    <li><a href="{{ url_for('student_dashboard') }}" class="nav-link">Dashboard</a></li>
                    {% elif session.role == 'college' %}
                    <li><a href="{{ url_for('college_dashboard') }}" class="nav-link">Dashboard</a></li>
                    {% elif session.role == 'provider' %}
                    <li><a href="{{ url_for('provider_dashboard') }}" class="nav-link">Dashboard</a></li>
                    {% elif session.role == 'admin' %}
                    <li><a href="{{ url_for('admin_dashboard') }}" class="nav-link">Dashboard</a></li>
                    {% endif %}

                    <!-- Profile Dropdown -->
                    <li style="position: relative;">
                        <a href="#" class="nav-link"
                            onclick="document.getElementById('profile-dropdown').classList.toggle('show'); return false;"
                            style="display: flex; align-items: center; gap: 8px; text-decoration: none;">
                            <span style="font-size: 0.9rem; font-weight: 500;">Hi, {{ session.name }}</span>
                            <span style="font-size: 0.8rem;">â–¼</span>
                        </a>
                        <div id="profile-dropdown"
                            style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e2e8f0; width: 200px; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 1000; overflow: hidden; margin-top: 0.5rem;">
                            <ul style="list-style: none; padding: 0.5rem 0; margin: 0;">
                                <li>
                                    <a href="#"
                                        style="display: block; padding: 0.5rem 1rem; color: #334155; text-decoration: none; font-size: 0.9rem;">Help
                                        Center</a>
                                </li>
                                {% if session.role == 'student' %}
                                <li>
                                    <a href="{{ url_for('edit_profile') }}"
                                        style="display: block; padding: 0.5rem 1rem; color: #334155; text-decoration: none; font-size: 0.9rem;">Edit
                                        Profile</a>
                                </li>
                                {% endif %}
                                <li style="border-top: 1px solid #f1f5f9; margin-top: 0.5rem; padding-top: 0.5rem;">
                                    <a href="{{ url_for('delete_account') }}"
                                        style="display: block; padding: 0.5rem 1rem; color: #dc2626; text-decoration: none; font-size: 0.9rem;">Delete
                                        Account</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('logout') }}"
                                        style="display: block; padding: 0.5rem 1rem; color: #334155; text-decoration: none; font-size: 0.9rem;">Logout</a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    {% else %}
                    <!-- Guest Links -->
                    <li><a href="{{ url_for('login') }}" class="nav-link btn btn-secondary"
                            style="border: none;">Login</a></li>
                    <li><a href="{{ url_for('register') }}" class="nav-link btn btn-primary">Sign Up</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <!-- Flash Messages -->
    <div class="container" style="margin-top: 2rem;">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Provics. All rights reserved.</p>
        </div>
    </footer>
    <style>
        .show {
            display: block !important;
        }
    </style>
</body>

</html>